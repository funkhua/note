# linux开机引导和启动过程

### 一、 systemd

#### 操作系统启动分为两个阶段: 引导 和 启动

#### 引导和启动分下面几个步骤
- BIOS上电自检(post)
- 引导装载程序(grub2)
- 内核初始化
- 启动systemd，pid=1，是所有进程的父进程


#### 1、BIOS上电自检(post)
  BIOS用于初始化硬件设备，检验电脑硬件基本功能是否正常。
  BIOS上电自检确认硬件的基本功能正常，然后产生一个BIOS中断INT13H，该中断指向某个接入的可引导设备的引导扇区。它所找到的包含有效的引导记录的第一个引导扇区将被装载到内存中，并且控制权也将从引导扇区转移到此段代码。

#### 2、引导装载程序(grub2)
  GRUB的最主要作用都是将内核加载到内存并运行，将控制权转交给内核。

#### 3、内核初始化
  内核文件首先必须从压缩格式解压自身。一旦内核自解压完成，则加载 systemd 进程（其是老式 System V 系统的 init 程序的替代品)，并转移控制权到 systemd。

#### 4、启动过程
  启动过程紧随着引导过程之后，启动过程使linux系统进入可操作状态，并能执行用户功能型任务。接下来systemd就可以按需启动各个进程。



### 二、 init

1. 加载BIOS的硬件信息与进行自我检测，并依据设置取得第一个可启动的设备;
2. 读取并执行第一个启动设备内的MBR的boot Loader(即是grub，spfdisk等程序);
3. 依据 boot Loader 的设置加载 Kernel， Kernel会检查硬件并加载驱动程序;
4. 在硬件驱动成功后，Kernel会主动调用init进程，而init会取得run-level信息；
5. init执行/etc/rc.d/rc.sysinit文件来准备软件执行的操作环境(如 网络 时区等)；
   init执行run-level的各个服务的启动(script方式)
   init执行/etc/rc.d/rc.local文件
   init执行终端机模拟程序mingetty来启动login进程，最后就等待用户登录。 